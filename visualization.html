<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LoL Champions Explorer</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        background: #0a0e1a;
        color: #e0e0e0;
        overflow: hidden;
        height: 100vh;
        width: 100vw;
      }

      #container {
        width: 100vw;
        height: 100vh;
        display: flex;
        flex-direction: column;
      }

      #header {
        padding: 15px 25px;
        background: rgba(10, 14, 26, 0.8);
        border-bottom: 1px solid rgba(74, 144, 226, 0.3);
        flex-shrink: 0;
      }

      #header h1 {
        font-size: 24px;
        background: linear-gradient(90deg, #4a90e2, #9333ea);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 5px;
      }

      #header p {
        font-size: 12px;
        color: #888;
      }

      #main {
        flex: 1;
        display: flex;
        overflow: hidden;
      }

      #sidebar {
        width: 260px;
        background: rgba(10, 14, 26, 0.9);
        border-right: 1px solid rgba(74, 144, 226, 0.2);
        padding: 20px;
        overflow-y: auto;
        flex-shrink: 0;
      }

      .section {
        margin-bottom: 25px;
      }

      .section-title {
        font-size: 13px;
        color: #4a90e2;
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-bottom: 12px;
        font-weight: 600;
      }

      .control {
        margin-bottom: 15px;
      }

      .control label {
        display: block;
        font-size: 11px;
        color: #a0a0a0;
        margin-bottom: 6px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .control select {
        width: 100%;
        padding: 8px;
        background: rgba(26, 26, 42, 0.8);
        border: 1px solid rgba(74, 144, 226, 0.3);
        border-radius: 4px;
        color: #e0e0e0;
        font-size: 12px;
        cursor: pointer;
      }

      .control select:hover {
        border-color: #4a90e2;
      }

      .control select option {
        background: #1a1a2a;
        color: #e0e0e0;
      }

      button {
        width: 100%;
        padding: 10px;
        background: linear-gradient(135deg, #4a90e2, #9333ea);
        border: none;
        border-radius: 5px;
        color: #ffffff;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        font-size: 12px;
        margin-top: 10px;
      }

      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(74, 144, 226, 0.4);
      }

      #chart-area {
        flex: 1;
        position: relative;
        background: rgba(0, 0, 0, 0.2);
        overflow: hidden;
      }

      #chart {
        width: 100%;
        height: 100%;
      }

      .grid-cell {
        fill: rgba(74, 144, 226, 0.1);
        stroke: rgba(74, 144, 226, 0.3);
        stroke-width: 1;
        cursor: pointer;
        transition: all 0.2s;
      }

      .grid-cell:hover {
        fill: rgba(74, 144, 226, 0.3);
        stroke: #4a90e2;
        stroke-width: 2;
        filter: drop-shadow(0 0 8px rgba(74, 144, 226, 0.6));
      }

      .grid-cell.has-champions {
        fill: rgba(74, 144, 226, 0.15);
      }

      .grid-cell.has-champions:hover {
        fill: rgba(74, 144, 226, 0.4);
        stroke-width: 3;
      }

      .champion-count-text {
        fill: #ffffff;
        font-size: 11px;
        font-weight: 700;
        text-anchor: middle;
        dominant-baseline: middle;
        pointer-events: none;
      }

      .axis {
        font-size: 11px;
        fill: #a0a0a0;
      }

      .axis-label {
        fill: #ffffff;
        font-size: 13px;
        font-weight: 600;
        text-anchor: middle;
      }

      .grid-line {
        stroke: rgba(255, 255, 255, 0.1);
        stroke-width: 1;
        stroke-dasharray: 2, 2;
      }

      .axis-line {
        stroke: rgba(255, 255, 255, 0.3);
        stroke-width: 1.5;
      }

      .champion-label {
        font-size: 10px;
        fill: #ffffff;
        text-anchor: middle;
        pointer-events: none;
        text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.8);
        font-weight: 500;
      }

      #tooltip {
        position: absolute;
        background: rgba(10, 14, 26, 0.95);
        border: 2px solid #4a90e2;
        border-radius: 8px;
        padding: 12px 16px;
        pointer-events: none;
        opacity: 0;
        transition: opacity 0.2s;
        z-index: 1000;
        max-width: 250px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
      }

      #tooltip.visible {
        opacity: 1;
      }

      #tooltip h3 {
        color: #4a90e2;
        margin-bottom: 6px;
        font-size: 15px;
      }

      #tooltip p {
        margin: 3px 0;
        font-size: 11px;
        color: #c0c0c0;
      }

      #tooltip .stat {
        color: #4a90e2;
        font-weight: 600;
      }

      #cell-tooltip {
        position: fixed;
        background: rgba(10, 14, 26, 0.98);
        border: 2px solid #4a90e2;
        border-radius: 8px;
        padding: 16px;
        pointer-events: auto;
        opacity: 0;
        transition: opacity 0.2s;
        z-index: 1000;
        width: 300px;
        max-height: 500px;
        overflow-y: auto;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
      }

      #cell-tooltip.visible {
        opacity: 1;
      }

      #cell-tooltip h3 {
        color: #4a90e2;
        margin-bottom: 10px;
        font-size: 14px;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      #cell-tooltip .champion-item {
        padding: 8px;
        margin-bottom: 6px;
        background: rgba(74, 144, 226, 0.1);
        border-radius: 4px;
        border-left: 3px solid #4a90e2;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      #cell-tooltip .champion-item:hover {
        background: rgba(74, 144, 226, 0.2);
        border-left-color: #ffd700;
      }

      #cell-tooltip .champion-color-indicator {
        width: 16px;
        height: 16px;
        border-radius: 3px;
        border: 2px solid rgba(255, 255, 255, 0.3);
        flex-shrink: 0;
      }

      #cell-tooltip .champion-info {
        flex: 1;
      }

      #cell-tooltip .champion-name {
        color: #ffffff;
        font-weight: 600;
        font-size: 12px;
        margin-bottom: 3px;
      }

      #cell-tooltip .champion-stats {
        color: #a0a0a0;
        font-size: 10px;
      }

      #info {
        position: absolute;
        bottom: 20px;
        left: 20px;
        background: rgba(10, 14, 26, 0.9);
        border: 1px solid rgba(74, 144, 226, 0.3);
        border-radius: 8px;
        padding: 10px 15px;
        font-size: 11px;
        color: #a0a0a0;
      }

      #info strong {
        color: #4a90e2;
      }

      #legend {
        position: absolute;
        top: 20px;
        left: 20px;
        background: rgba(10, 14, 26, 0.9);
        border: 1px solid rgba(74, 144, 226, 0.3);
        border-radius: 8px;
        padding: 12px 16px;
        max-width: 200px;
      }

      #legend h4 {
        color: #4a90e2;
        font-size: 12px;
        margin-bottom: 10px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .legend-item {
        display: flex;
        align-items: center;
        margin-bottom: 6px;
        font-size: 11px;
      }

      .legend-color {
        width: 14px;
        height: 14px;
        border-radius: 3px;
        margin-right: 8px;
        border: 1px solid rgba(255, 255, 255, 0.3);
      }
    </style>
  </head>
  <body>
    <div id="container">
      <div id="header">
        <h1>League of Legends Champions Explorer</h1>
        <p id="subtitle">
          Interactive Grid Visualization | Click on grid cells to explore
          champion stats | Data from Season 15 League of Legends Champion Data
          (2025) Kaggle dataset and the official League of Legends website
        </p>
      </div>

      <div id="main">
        <div id="sidebar">
          <div class="section">
            <div class="section-title">Axes & Encoding</div>
            <div class="control">
              <label>X-Axis</label>
              <select id="x-axis">
                <option value="control">Control</option>
                <option value="damage">Damage</option>
                <option value="mobility">Mobility</option>
                <option value="toughness">Toughness</option>
                <option value="utility">Utility</option>
              </select>
            </div>
            <div class="control">
              <label>Y-Axis</label>
              <select id="y-axis">
                <option value="control">Control</option>
                <option value="damage">Damage</option>
                <option value="mobility">Mobility</option>
                <option value="toughness">Toughness</option>
                <option value="utility">Utility</option>
              </select>
            </div>
            <div class="control">
              <label>Color By</label>
              <select id="color-by">
                <option value="control">Control</option>
                <option value="damage">Damage</option>
                <option value="difficulty">Difficulty</option>
                <option value="mobility">Mobility</option>
                <option value="region">Region</option>
                <option value="toughness">Toughness</option>
                <option value="utility">Utility</option>
              </select>
            </div>
          </div>

          <div class="section">
            <div class="section-title">Filters</div>
            <div class="control">
              <label>Hero Type</label>
              <select id="type-filter">
                <option value="all">All Types</option>
                <option value="Assassin">Assassin</option>
                <option value="Fighter">Fighter</option>
                <option value="Mage">Mage</option>
                <option value="Marksman">Marksman</option>
                <option value="Support">Support</option>
                <option value="Tank">Tank</option>
              </select>
            </div>
            <div class="control">
              <label>Difficulty</label>
              <select id="difficulty-filter">
                <option value="all">All Difficulties</option>
                <option value="1">Easy</option>
                <option value="2">Medium</option>
                <option value="3">Hard</option>
              </select>
            </div>
            <div class="control">
              <label>Range Type</label>
              <select id="range-filter">
                <option value="all">All Ranges</option>
                <option value="Melee">Melee</option>
                <option value="Ranged">Ranged</option>
              </select>
            </div>
            <div class="control">
              <label>Region</label>
              <select id="region-filter">
                <option value="all">All Regions</option>
                <option value="Bandle City">Bandle City</option>
                <option value="Bilgewater">Bilgewater</option>
                <option value="Demacia">Demacia</option>
                <option value="Freljord">Freljord</option>
                <option value="Ionia">Ionia</option>
                <option value="Ixtal">Ixtal</option>
                <option value="Noxus">Noxus</option>
                <option value="Piltover">Piltover</option>
                <option value="Runeterra">Runeterra</option>
                <option value="Shadow Isles">Shadow Isles</option>
                <option value="Shurima">Shurima</option>
                <option value="Targon">Targon</option>
                <option value="Zaun">Zaun</option>
              </select>
            </div>
          </div>
        </div>

        <div id="chart-area">
          <svg id="chart"></svg>
          <div id="legend"></div>
          <div id="tooltip"></div>
          <div id="cell-tooltip"></div>
        </div>
      </div>
    </div>

    <script src="data.js"></script>
    <script>
      let allChampions = [];
      let filteredChampions = [];
      let svg, g, xScale, yScale, colorScale;
      let gridCells;
      let margin = { top: 50, right: 50, bottom: 120, left: 60 };
      let gridSize = 20;
      function init() {
        if (typeof championData === "undefined" || !championData.champions) {
          setTimeout(init, 100);
          return;
        }

        allChampions = championData.champions;
        filteredChampions = [...allChampions];

        setupVisualization();
        setupEventListeners();
        updateVisualization();
      }

      function setupVisualization() {
        svg = d3.select("#chart");
        const width = window.innerWidth - 260;
        const height = window.innerHeight - 60;

        svg.attr("width", width).attr("height", height);

        g = svg
          .append("g")
          .attr("transform", `translate(${margin.left},${margin.top})`);

        setupEventListeners();
        updateVisualization();
      }

      function setupEventListeners() {
        d3.select("#x-axis").on("change", updateVisualization);
        d3.select("#y-axis").on("change", updateVisualization);
        d3.select("#color-by").on("change", updateVisualization);
        d3.select("#type-filter").on("change", updateFilters);
        d3.select("#difficulty-filter").on("change", updateFilters);
        d3.select("#range-filter").on("change", updateFilters);
        d3.select("#region-filter").on("change", updateFilters);

        window.addEventListener("resize", () => {
          const width = window.innerWidth - 260;
          const height = window.innerHeight - 60;
          svg.attr("width", width).attr("height", height);
          updateVisualization();
        });
      }

      function updateFilters() {
        const type = d3.select("#type-filter").property("value");
        const difficulty = d3.select("#difficulty-filter").property("value");
        const range = d3.select("#range-filter").property("value");
        const region = d3.select("#region-filter").property("value");

        filteredChampions = allChampions.filter((champion) => {
          if (type !== "all" && champion.herotype !== type) return false;
          if (difficulty !== "all" && champion.difficulty != difficulty)
            return false;
          if (range !== "all" && champion.rangetype !== range) return false;
          if (region !== "all" && champion.region !== region) return false;
          return true;
        });

        updateVisualization();
      }

      function updateVisualization() {
        const xAxisStat = d3.select("#x-axis").property("value");
        const yAxisStat = d3.select("#y-axis").property("value");
        const colorBy = d3.select("#color-by").property("value");

        const width = window.innerWidth - 260 - margin.left - margin.right;
        const height = window.innerHeight - 60 - margin.top - margin.bottom;

        hideCellTooltip();
        g.selectAll("*").remove();

        xScale = d3.scaleLinear().domain([0, 3]).range([0, width]);

        yScale = d3.scaleLinear().domain([0, 3]).range([height, 0]);

        // Color scale
        if (colorBy === "region") {
          const regions = Array.from(
            new Set(filteredChampions.map((c) => c.region).filter(Boolean))
          );
          const colors = [
            "#8dd3c7",
            "#ffffb3",
            "#bebada",
            "#fb8072",
            "#80b1d3",
            "#fdb462",
            "#b3de69",
            "#fccde5",
            "#d9d9d9",
            "#bc80bd",
            "#ccebc5",
            "#ffed6f",
          ];
          colorScale = d3
            .scaleOrdinal()
            .domain(regions)
            .range(colors.slice(0, regions.length));
        } else if (colorBy === "difficulty") {
          colorScale = d3
            .scaleOrdinal()
            .domain([1, 2, 3])
            .range(["#4caf50", "#ffc107", "#f44336"]);
        } else {
          colorScale = d3.scaleSequential(d3.interpolateViridis).domain([0, 3]);
        }

        const xAxis = d3.axisBottom(xScale).tickValues([0, 1, 2, 3]);
        const yAxis = d3.axisLeft(yScale).tickValues([0, 1, 2, 3]);

        g.append("g")
          .attr("class", "axis")
          .attr("transform", `translate(0,${height})`)
          .call(xAxis);

        g.append("g").attr("class", "axis").call(yAxis);

        const gridTicks = [0, 1, 2, 3];
        g.append("g")
          .attr("class", "grid")
          .attr("transform", `translate(0,${height})`)
          .selectAll("line")
          .data(gridTicks)
          .enter()
          .append("line")
          .attr("class", "grid-line")
          .attr("x1", (d) => xScale(d))
          .attr("x2", (d) => xScale(d))
          .attr("y1", 0)
          .attr("y2", -height);

        g.append("g")
          .attr("class", "grid")
          .selectAll("line")
          .data(gridTicks)
          .enter()
          .append("line")
          .attr("class", "grid-line")
          .attr("x1", 0)
          .attr("x2", width)
          .attr("y1", (d) => yScale(d))
          .attr("y2", (d) => yScale(d));

        // Axis labels
        g.append("text")
          .attr("class", "axis-label")
          .attr("x", width / 2)
          .attr("y", height + 70)
          .text(xAxisStat.charAt(0).toUpperCase() + xAxisStat.slice(1));

        g.append("text")
          .attr("class", "axis-label")
          .attr("x", -height / 2)
          .attr("y", -40)
          .attr("transform", "rotate(-90)")
          .text(yAxisStat.charAt(0).toUpperCase() + yAxisStat.slice(1));

        const gridData = new Map();
        filteredChampions.forEach((champion) => {
          const xVal = champion[xAxisStat] || 0;
          const yVal = champion[yAxisStat] || 0;

          const nearestX = Math.max(0, Math.min(3, Math.round(xVal)));
          const nearestY = Math.max(0, Math.min(3, Math.round(yVal)));
          const key = `${nearestX},${nearestY}`;

          if (!gridData.has(key)) {
            const centerX = xScale(nearestX);
            const centerY = yScale(nearestY);

            gridData.set(key, {
              gridX: nearestX,
              gridY: nearestY,
              centerX: centerX,
              centerY: centerY,
              champions: [],
            });
          }
          gridData.get(key).champions.push(champion);
        });

        const cellDataArray = Array.from(gridData.values());
        cellDataArray.forEach((cell) => {
          if (colorBy === "region" || colorBy === "difficulty") {
            const counts = {};
            cell.champions.forEach((champ) => {
              const val = champ[colorBy];
              counts[val] = (counts[val] || 0) + 1;
            });
            const mostCommon = Object.keys(counts).reduce((a, b) =>
              counts[a] > counts[b] ? a : b
            );
            cell.color = colorScale(mostCommon) || "#4a90e2";
          } else {
            const avg =
              cell.champions.reduce(
                (sum, champ) => sum + (champ[colorBy] || 0),
                0
              ) / cell.champions.length;
            cell.color = colorScale(avg);
          }

          cell.champions.forEach((champ) => {
            if (colorBy === "region" || colorBy === "difficulty") {
              champ._displayColor = colorScale(champ[colorBy]) || "#4a90e2";
            } else {
              champ._displayColor = colorScale(champ[colorBy] || 0);
            }
          });
        });

        const cellSize = Math.min(width, height) / 8;
        const radius = cellSize * 0.4;

        gridCells = g
          .append("g")
          .selectAll(".grid-cell")
          .data(cellDataArray)
          .enter()
          .append("circle")
          .attr("class", "grid-cell has-champions")
          .attr("cx", (d) => d.centerX)
          .attr("cy", (d) => d.centerY)
          .attr("r", radius)
          .attr("fill", (d) => d.color)
          .attr("stroke", "#ffffff")
          .attr("stroke-width", 1.5)
          .on("click", handleCellClick)
          .style("cursor", "pointer");
        g.append("g")
          .selectAll(".champion-count-text")
          .data(cellDataArray)
          .enter()
          .append("text")
          .attr("class", "champion-count-text")
          .attr("x", (d) => d.centerX)
          .attr("y", (d) => d.centerY)
          .attr("text-anchor", "middle")
          .attr("dominant-baseline", "middle")
          .attr("pointer-events", "none")
          .style("pointer-events", "none")
          .text((d) => d.champions.length);

        updateLegend(colorBy, colorScale);
        d3.select("#subtitle").text(
          `Interactive Grid Visualization | ${filteredChampions.length} champions displayed | Click on grid cells to explore | Data from Season 15 League of Legends Champion Data (2025) Kaggle dataset and the official League of Legends website`
        );
      }

      function updateLegend(colorBy, colorScale) {
        const legend = d3.select("#legend");
        legend.selectAll("*").remove();

        legend.append("h4").text(`Color: ${colorBy}`);

        if (colorBy === "region") {
          const categories = Array.from(
            new Set(
              filteredChampions
                .map((c) => c[colorBy])
                .filter((cat) => cat != null && cat !== "")
            )
          );
          categories.forEach((cat) => {
            const item = legend.append("div").attr("class", "legend-item");
            item
              .append("div")
              .attr("class", "legend-color")
              .style("background-color", colorScale(cat));
            item.append("span").text(cat);
          });
        } else if (colorBy === "difficulty") {
          const difficulties = ["Easy", "Medium", "Hard"];
          const colors = ["#4caf50", "#ffc107", "#f44336"];
          difficulties.forEach((diff, i) => {
            const item = legend.append("div").attr("class", "legend-item");
            item
              .append("div")
              .attr("class", "legend-color")
              .style("background-color", colors[i]);
            item.append("span").text(diff);
          });
        } else {
          const item = legend.append("div").attr("class", "legend-item");
          item.append("span").text("Low â†’ High");
          item
            .append("div")
            .style("width", "100px")
            .style("height", "10px")
            .style(
              "background",
              "linear-gradient(to right, #440154, #31688e, #35b779)"
            )
            .style("margin-left", "10px");
        }
      }

      let activeTooltipCellKey = null;

      function handleCellClick(event, d) {
        event.stopPropagation();
        const cellKey = `${d.gridX},${d.gridY}`;
        const isSameCell = activeTooltipCellKey === cellKey;

        if (isSameCell) {
          hideCellTooltip();
        } else {
          activeTooltipCellKey = cellKey;
          showCellTooltip(event, d);
        }
      }

      function showCellTooltip(event, cellData) {
        const tooltip = d3.select("#cell-tooltip");
        let html = `<h3>${cellData.champions.length} Champion${
          cellData.champions.length > 1 ? "s" : ""
        }</h3>`;

        const xAxisStat = d3.select("#x-axis").property("value");
        const yAxisStat = d3.select("#y-axis").property("value");

        html += `<p style="color: #888; font-size: 10px; margin-bottom: 10px;">`;
        html += `${xAxisStat}: ${cellData.gridX} | ${yAxisStat}: ${cellData.gridY}`;
        html += `</p>`;

        cellData.champions.forEach((champion) => {
          const champColor = champion._displayColor || "#4a90e2";
          html += `<div class="champion-item">`;
          html += `<div class="champion-color-indicator" style="background-color: ${champColor};"></div>`;
          html += `<div class="champion-info">`;
          html += `<div class="champion-name">${champion.name}</div>`;
          html += `<div class="champion-stats">`;
          html += `${champion.herotype} | ${champion.region || "Unknown"} | `;
          html += `D:${champion.damage} T:${champion.toughness} M:${champion.mobility} C:${champion.control} U:${champion.utility}`;
          html += `</div>`;
          html += `</div>`;
          html += `</div>`;
        });

        const tooltipWidth = 300;
        const tooltipHeight = Math.min(
          500,
          cellData.champions.length * 50 + 80
        );
        let left = event.pageX + 15;
        let top = event.pageY - 10;

        if (left + tooltipWidth > window.innerWidth) {
          left = event.pageX - tooltipWidth - 15;
        }
        if (top + tooltipHeight > window.innerHeight) {
          top = window.innerHeight - tooltipHeight - 20;
        }
        if (top < 20) {
          top = 20;
        }

        tooltip
          .html(html)
          .style("left", left + "px")
          .style("top", top + "px")
          .style("opacity", "1")
          .style("pointer-events", "auto")
          .classed("visible", true);
      }

      function hideCellTooltip() {
        const tooltip = d3.select("#cell-tooltip");
        tooltip.classed("visible", false);
        tooltip.style("opacity", "0");
        tooltip.style("pointer-events", "none");
        activeTooltipCellKey = null;
      }

      document.addEventListener("click", (event) => {
        const target = event.target;
        const isGridCell =
          target &&
          (target.classList.contains("grid-cell") ||
            target.classList.contains("has-champions") ||
            (target.tagName === "circle" &&
              d3.select(target).classed("grid-cell")));

        if (isGridCell) {
          return;
        }

        const tooltip = d3.select("#cell-tooltip").node();
        const clickedChampionItem = event.target.closest(".champion-item");

        if (
          activeTooltipCellKey &&
          tooltip &&
          !tooltip.contains(event.target) &&
          !clickedChampionItem
        ) {
          hideCellTooltip();
        }
      });

      function tryInit() {
        if (typeof championData !== "undefined" && championData.champions) {
          init();
        } else {
          setTimeout(tryInit, 100);
        }
      }

      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", () => {
          setTimeout(tryInit, 100);
        });
      } else {
        setTimeout(tryInit, 100);
      }
    </script>
  </body>
</html>
